#!/usr/bin/env python3
# Converts the Haiku OS Scrypt password hashes (Inside of /boot/system/settings/etc/shadow) to a format hashcat knows (8900).
__author__ = 'Jon Stratton'

import sys, base64

R = 8
P = 1
HASH_LEN = 32

# Takes a password hash or line from the passwd file, and pull out the needed elements.
def parse_passwd(line):
   n = password_hash = password_salt = None
   for val in line.split(':'):
      if val.startswith('$s$'):
         split_val = val.split('$')
         n = int(split_val[2])
         password_salt = bytes.fromhex(split_val[3])
         password_hash = bytes.fromhex(split_val[4])
   return n, password_hash, password_salt

if __name__ == '__main__':
   n, password_hash, password_salt = parse_passwd(sys.argv[1])
   if password_salt:
      print("SCRYPT:%d:%d:%d:%s:%s" % ((2**n), R, P, base64.b64encode(password_salt).decode(), base64.b64encode(password_hash).decode()))
   else:
      print("No Scrypt hash found.")
